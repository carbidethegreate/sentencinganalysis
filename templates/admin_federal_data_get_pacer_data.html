{% extends "admin_federal_data_base.html" %}

{% block federal_content %}
  {% if pacer_authorized %}
    <div class="card">
      <p><strong>PACER session active.</strong></p>
      <p class="small">You're authorized to make PACER Case Locator requests. Choose a next step.</p>
      {% if pacer_authorized_at %}
        <p class="small">Authorized at {{ pacer_authorized_at.replace('T', ' ') }} UTC.</p>
      {% endif %}
      <div class="actions">
        <a class="pill" href="{{ url_for('admin_federal_data_dashboard_pcl_batch_search') }}">PCL Batch Search</a>
        <a class="pill" href="{{ url_for('admin_federal_data_dashboard_expand_existing') }}">Expand Existing PCL Data</a>
        <a class="pill" href="{{ url_for('admin_federal_data_dashboard_advanced') }}">Advanced</a>
      </div>
      <form method="post" action="{{ url_for('admin_federal_data_dashboard_pacer_logout') }}" style="margin-top: 16px;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <button class="secondary" type="submit">Clear PACER session</button>
      </form>
    </div>
  {% else %}
    <div class="card" style="max-width: 720px;">
      <p class="small">
        Authenticate with PACER to enable Case Locator requests. Credentials are only used to
        request a token and are never stored.
      </p>
      {% if pacer_env_notice %}
        <div class="flash">
          {{ pacer_env_notice }}
        </div>
      {% endif %}
      {% if pacer_needs_otp %}
        <p class="small"><strong>2FA required.</strong> Enter the one-time passcode from your authenticator app.</p>
      {% endif %}
      <form method="post" action="{{ url_for('admin_federal_data_dashboard_pacer_auth') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <div class="grid two">
          <div>
            <label for="pacer-username">PACER username</label>
            <input id="pacer-username" name="pacer_username" autocomplete="off" required>
          </div>
          <div>
            <label for="pacer-password">PACER password</label>
            <input id="pacer-password" name="pacer_password" type="password" autocomplete="new-password" required>
          </div>
        </div>
        <div style="margin-top: 12px;">
          <label for="pacer-client-code">Client code (optional)</label>
          <input
            id="pacer-client-code"
            name="pacer_client_code"
            autocomplete="off"
            {% if pacer_client_code_required %}class="input-error"{% endif %}
          >
          {% if pacer_client_code_required %}
            <p class="small" style="color: var(--danger); margin-top: 6px;">
              Client code required for this account. Enter the PACER-provided client code and try again.
            </p>
          {% endif %}
        </div>
        <div style="margin-top: 12px;">
          <label for="pacer-otp">2FA code (only if prompted)</label>
          <input id="pacer-otp" name="pacer_otp" autocomplete="one-time-code" inputmode="numeric">
        </div>
        <div class="actions" style="margin-top: 16px;">
          <button class="primary" type="submit">Authorize</button>
        </div>
      </form>
      <p class="small" style="margin-top: 16px;">
        PACER authentication endpoint: {{ pacer_base_url }} (set <code>PACER_AUTH_BASE_URL</code> to switch environments).
      </p>
    </div>
  {% endif %}
{% endblock %}
