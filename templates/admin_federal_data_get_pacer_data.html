{% extends "admin_federal_data_base.html" %}

{% block federal_content %}
  {% if pacer_authorized %}
    <div class="card">
      <p><strong>PACER session active.</strong></p>
      <p class="small">You're authorized to make PACER Case Locator requests. Choose a next step.</p>
      {% if pacer_authorized_at %}
        <p class="small">Authorized at {{ pacer_authorized_at.replace('T', ' ') }} UTC.</p>
      {% endif %}
      <div class="actions">
        <a class="pill" href="{{ url_for('admin_federal_data_dashboard_pcl_batch_search') }}">PCL Batch Search</a>
        <a class="pill" href="{{ url_for('admin_federal_data_dashboard_expand_existing') }}">Expand Existing PCL Data</a>
        <a class="pill" href="{{ url_for('admin_federal_data_dashboard_advanced') }}">Advanced</a>
      </div>
      <form method="post" action="{{ url_for('admin_federal_data_dashboard_pacer_logout') }}" style="margin-top: 16px;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <button class="secondary" type="submit">Clear PACER session</button>
      </form>
    </div>
  {% else %}
    <div class="card" style="max-width: 720px;">
      <p class="small">
        Authenticate with PACER to enable Case Locator requests. Credentials are only used to
        request a token and are never stored.
      </p>
      {% if pacer_env_notice %}
        <div class="flash">
          {{ pacer_env_notice }}
        </div>
      {% endif %}
      {% if pacer_needs_otp %}
        <p class="small"><strong>2FA required.</strong> Enter the one-time passcode from your authenticator app.</p>
      {% endif %}
      <form method="post" action="{{ url_for('admin_federal_data_dashboard_pacer_auth') }}" autocomplete="off">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        {% if pacer_server_creds_available and not manual_mode %}
          <div class="small" style="margin-bottom: 12px;">
            PACER credentials are configured on the server; they are not shown in the browser.
          </div>
          <div class="small" style="margin-bottom: 12px;">
            <a href="{{ url_for('admin_federal_data_dashboard_get_pacer_data', manual='1') }}">
              Enter PACER username/password manually
            </a>
          </div>
        {% else %}
          {% if manual_mode %}
            <input type="hidden" name="manual_mode" value="1">
          {% endif %}
          <div style="position:absolute; left:-10000px; width:1px; height:1px; overflow:hidden;">
            <label for="pacer-decoy-username">Username</label>
            <input
              id="pacer-decoy-username"
              name="username"
              type="text"
              autocomplete="username"
              tabindex="-1"
              aria-hidden="true"
            >
            <label for="pacer-decoy-password">Password</label>
            <input
              id="pacer-decoy-password"
              name="password"
              type="password"
              autocomplete="current-password"
              tabindex="-1"
              aria-hidden="true"
            >
          </div>
          <div class="grid two">
            <div>
              <label for="pacer-login-id">PACER login ID</label>
              <input
                id="pacer-login-id"
                name="pacer_login_id"
                autocomplete="off"
                required
                data-lpignore="true"
                data-1p-ignore="true"
                data-bwignore="true"
              >
            </div>
            <div>
              <label for="pacer-login-secret">PACER password</label>
              <input
                id="pacer-login-secret"
                name="pacer_login_secret"
                type="password"
                autocomplete="new-password"
                required
                data-lpignore="true"
                data-1p-ignore="true"
                data-bwignore="true"
              >
            </div>
          </div>
        {% endif %}
        <div style="margin-top: 12px;">
          <label for="pacer-client-code">Client code (optional)</label>
          <input
            id="pacer-client-code"
            name="pacer_client_code"
            autocomplete="off"
            {% if pacer_client_code_required %}class="input-error"{% endif %}
            data-lpignore="true"
            data-1p-ignore="true"
            data-bwignore="true"
          >
          {% if pacer_client_code_required %}
            <p class="small" style="color: var(--danger); margin-top: 6px;">
              Client code required for this account. Enter the PACER-provided client code and try again.
            </p>
          {% endif %}
        </div>
        <div style="margin-top: 12px;">
          <label for="pacer-otp-code">2FA code (required if your PACER account uses MFA)</label>
          <input
            id="pacer-otp-code"
            name="pacer_otp_code"
            autocomplete="one-time-code"
            inputmode="numeric"
            data-lpignore="true"
            data-1p-ignore="true"
            data-bwignore="true"
          >
        </div>
        <div class="actions" style="margin-top: 16px;">
          <button class="primary" type="submit">Authorize</button>
        </div>
      </form>
      <p class="small" style="margin-top: 16px;">
        PACER authentication endpoint: {{ pacer_base_url }} (set <code>PACER_AUTH_BASE_URL</code> to switch environments).
      </p>
    </div>
  {% endif %}
{% endblock %}
