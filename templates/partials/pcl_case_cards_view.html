  <section class="card stack">
    <p class="pacer-eyebrow">PACER cases</p>
    <h2>Cases</h2>
    <p class="small">
      These are the cases you saved from PACER. Open a case to see parties/counsel details, or pull the docket to refresh case metadata.
    </p>

    <form method="get" class="pcl-filter-form" aria-label="Filter cases">
      <div class="grid two">
        <div>
          <label for="case-cards-court">Court</label>
          <input
            id="case-cards-court"
            name="court_id"
            list="case-cards-court-list"
            value="{{ filters.court_id }}"
            placeholder="Type a court code (e.g., vidc)"
          >
          <datalist id="case-cards-court-list">
            {% for court in court_choices %}
              <option value="{{ court.court_id }}">{{ court.label }}</option>
            {% endfor %}
          </datalist>
        </div>
        <div>
          <label for="case-cards-type">Case type</label>
          <select id="case-cards-type" name="case_type">
            <option value="">All case types</option>
            {% for case_type, label in case_type_choices %}
              <option value="{{ case_type }}" {% if filters.case_type == case_type %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="case-cards-date-from">Date filed from</label>
          <input id="case-cards-date-from" type="date" name="date_filed_from" value="{{ filters.date_filed_from.isoformat() if filters.date_filed_from else '' }}">
        </div>
        <div>
          <label for="case-cards-date-to">Date filed to</label>
          <input id="case-cards-date-to" type="date" name="date_filed_to" value="{{ filters.date_filed_to.isoformat() if filters.date_filed_to else '' }}">
        </div>
        <div>
          <label for="case-cards-judge">Judge last name</label>
          <input id="case-cards-judge" name="judge_last_name" value="{{ filters.judge_last_name }}" placeholder="e.g., Jackson">
        </div>
        <div>
          <label for="case-cards-search">Search title/number</label>
          <input id="case-cards-search" name="q" value="{{ filters.search_text }}" placeholder="Case number or title">
        </div>
      </div>

      <details class="pcl-advanced-filters">
        <summary class="pcl-detail-summary">Advanced filters</summary>
        <div class="grid two mt-12">
          <div>
            <label for="case-cards-field-name">Field name</label>
            <input id="case-cards-field-name" name="field_name" list="case-cards-field-name-list" value="{{ filters.field_name }}" placeholder="e.g., caseId">
            <datalist id="case-cards-field-name-list">
              {% for field_name in case_field_choices %}
                <option value="{{ field_name }}"></option>
              {% endfor %}
            </datalist>
            <p class="small">Search any saved PACER field for the case.</p>
          </div>
          <div>
            <label for="case-cards-field-value">Field value contains</label>
            <input id="case-cards-field-value" name="field_value" value="{{ filters.field_value }}" placeholder="e.g., 2025 or vidc">
          </div>
        </div>
      </details>

      <div class="actions pcl-filter-actions">
        <button class="primary" type="submit">Apply filters</button>
        <a class="pill" href="{{ url_for('admin_federal_data_dashboard_cases', source='pacer', view='cards') }}">Reset</a>
      </div>
    </form>
  </section>

  <section class="pcl-card-grid" aria-live="polite">
    {% if cases %}
      {% for case in cases %}
        {% set docket_status = (case.get("enrichment_status") or "none") %}
        {% set docket_badge_variant = "stub" %}
        {% if docket_status == "completed" %}
          {% set docket_badge_variant = "indexed" %}
        {% elif docket_status in ["queued", "running"] %}
          {% set docket_badge_variant = "warning" %}
        {% elif docket_status == "failed" %}
          {% set docket_badge_variant = "danger" %}
        {% endif %}
        {% set judge_display = case.get("judge_last_name") or "—" %}
        {% if case.get("docket_judges") and (case.get("docket_judges")|length) > 0 %}
          {% set judge_display = case.get("docket_judges")[0] %}
        {% endif %}
        {% set counsel_count = case.get("docket_attorney_count") %}
        {% set party_count = case.get("docket_party_count") %}
        <article class="card pcl-case-card">
          <header class="pcl-case-card__header">
            <div>
              <p class="pcl-case-card__number">{{ case.get("case_number_full") or case.get("case_number") }}</p>
              <h3 class="pcl-case-card__title">{{ case.get("case_title") or case.get("short_title") or "Untitled case" }}</h3>
            </div>
            <div class="pcl-case-card__badges">
              <span class="pcl-badge" data-variant="indexed">Saved</span>
              <span class="pcl-badge" data-variant="{{ docket_badge_variant }}">
                Docket: {{ docket_status }}
              </span>
              <span class="pcl-badge" data-variant="{{ 'indexed' if case.get('has_sentencing') else 'stub' }}">
                Sentencing: {{ "yes" if case.get("has_sentencing") else "no" }}
              </span>
            </div>
          </header>

          <dl class="pcl-case-meta">
            <div>
              <dt>Date filed</dt>
              <dd>{{ case.get("date_filed").isoformat() if case.get("date_filed") else "—" }}</dd>
            </div>
            <div>
              <dt>Court</dt>
              <dd>{{ case.get("court_id") or "—" }}</dd>
            </div>
            <div>
              <dt>Case type</dt>
              <dd>{{ case.get("case_type") or "—" }}</dd>
            </div>
            <div>
              <dt>Judge</dt>
              <dd>{{ judge_display }}</dd>
            </div>
            <div>
              <dt>Parties</dt>
              <dd>{{ party_count if party_count is not none else "—" }}</dd>
            </div>
            <div>
              <dt>Counsel</dt>
              <dd>{{ counsel_count if counsel_count is not none else "—" }}</dd>
            </div>
          </dl>

          <footer class="pcl-case-card__footer">
            <span class="small">
              Docket updated:
              {% if case.get("enrichment_updated_at") %}
                {{ case.get("enrichment_updated_at").isoformat() }}
              {% else %}
                —
              {% endif %}
            </span>
            <form method="post" action="{{ url_for('admin_pcl_case_queue_docket_enrichment', case_id=case.get('id')) }}">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <input type="hidden" name="include_docket_text" value="1">
              <button class="secondary" type="submit">Pull docket</button>
            </form>
            <a class="pill" href="{{ url_for('admin_pcl_case_detail', case_id=case.get('id')) }}">Open case</a>
            <a
              class="pill"
              href="{{ url_for('admin_pcl_attorneys', q=(case.get('case_number_full') or case.get('case_number') or ''), court_id=(case.get('court_id') or ''), case_type=(case.get('case_type') or '')) }}"
            >
              Counsel
            </a>
          </footer>
        </article>
      {% endfor %}
    {% else %}
      <div class="card pcl-empty-state">
        <h3>No saved cases yet</h3>
        <p class="small">Run a PACER search and click “Save to database” to create cards.</p>
      </div>
    {% endif %}
  </section>

  <nav class="pcl-pagination" aria-label="Case card pagination">
    {% set total_pages = pagination.total_pages %}
    {% set current_page = pagination.page %}
    <span class="small">Page {{ current_page }} of {{ total_pages }}</span>
    <div class="pcl-pagination__actions">
      <a class="pill {% if current_page <= 1 %}disabled{% endif %}" href="{{ page_url(current_page - 1) if current_page > 1 else '#' }}" aria-disabled="{{ 'true' if current_page <= 1 else 'false' }}">Previous</a>
      <a class="pill {% if current_page >= total_pages %}disabled{% endif %}" href="{{ page_url(current_page + 1) if current_page < total_pages else '#' }}" aria-disabled="{{ 'true' if current_page >= total_pages else 'false' }}">Next</a>
    </div>
  </nav>
